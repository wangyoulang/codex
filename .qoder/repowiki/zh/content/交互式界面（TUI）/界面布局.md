# 界面布局

<cite>
**本文档引用的文件**
- [app.rs](file://codex-rs/tui/src/app.rs)
- [chatwidget.rs](file://codex-rs/tui/src/chatwidget.rs)
- [bottom_pane/mod.rs](file://codex-rs/tui/src/bottom_pane/mod.rs)
- [bottom_pane/chat_composer.rs](file://codex-rs/tui/src/bottom_pane/chat_composer.rs)
- [status/mod.rs](file://codex-rs/tui/src/status/mod.rs)
- [status/rate_limits.rs](file://codex-rs/tui/src/status/rate_limits.rs)
- [status/account.rs](file://codex-rs/tui/src/status/account.rs)
- [ui_consts.rs](file://codex-rs/tui/src/ui_consts.rs)
</cite>

## 目录
1. [主界面三大核心区域](#主界面三大核心区域)
2. [顶部状态栏信息显示](#顶部状态栏信息显示)
3. [底部面板结构](#底部面板结构)
4. [组件相对位置示意图](#组件相对位置示意图)

## 主界面三大核心区域

Codex TUI界面采用垂直分层布局，主要由三大核心区域构成：顶部的聊天历史显示区、中部的实时响应流式渲染区以及底部的输入与状态控制区。

顶部的聊天历史显示区由`chatwidget`模块管理，负责展示用户与AI的完整对话历史。该区域会持续累积所有已提交的用户请求和AI的响应内容，形成一个可滚动的对话记录流。中部的实时响应流式渲染区是`chatwidget`的核心功能之一，它能够以流式方式实时渲染AI的响应内容，为用户提供即时的反馈体验。当AI正在生成响应时，该区域会动态更新，逐字逐句地显示生成的内容。

底部的输入与状态控制区由`bottom_pane`模块管理，是用户与系统交互的主要入口。该区域包含一个输入框（`chat_composer`），用户可以在此输入问题或指令。同时，该区域还集成了状态指示器、功能按钮和命令提示符，为用户提供丰富的交互功能。

**Section sources**
- [app.rs](file://codex-rs/tui/src/app.rs#L288-L325)
- [chatwidget.rs](file://codex-rs/tui/src/chatwidget.rs#L313-L372)
- [bottom_pane/mod.rs](file://codex-rs/tui/src/bottom_pane/mod.rs#L64-L90)

## 顶部状态栏信息显示

顶部状态栏是界面的重要信息展示区域，主要由`status`模块中的`account`和`rate_limits`组件提供数据支持。状态栏实时显示用户的账户信息、信用额度和速率限制状态，帮助用户了解当前的使用情况。

账户信息组件（`account`）根据用户的认证模式显示相应的信息。对于使用ChatGPT账户的用户，会显示其邮箱地址和订阅计划类型；对于使用API密钥的用户，则会显示“API密钥”标识。这些信息帮助用户确认当前的登录状态和账户类型。

速率限制状态组件（`rate_limits`）提供详细的使用配额信息。它会显示两个主要的速率限制窗口：一个较短的窗口（如5小时）和一个较长的窗口（如每周）。对于每个窗口，系统会计算已使用的百分比，并以进度条的形式直观展示剩余配额。当使用量达到特定阈值（如75%、90%）时，系统会发出警告，提醒用户注意配额使用情况。此外，如果账户启用了信用额度跟踪，状态栏还会显示剩余的信用额度。

**Section sources**
- [status/account.rs](file://codex-rs/tui/src/status/account.rs#L1-L9)
- [status/rate_limits.rs](file://codex-rs/tui/src/status/rate_limits.rs#L1-L225)
- [chatwidget.rs](file://codex-rs/tui/src/chatwidget.rs#L325-L328)

## 底部面板结构

底部面板（`bottom_pane_view`）是用户交互的核心区域，其结构设计旨在提供高效、直观的操作体验。该面板主要由聊天输入框（`chat_composer`）、命令提示符和功能按钮三部分组成。

聊天输入框（`chat_composer`）是用户输入的主要区域，支持多行文本输入。输入框左侧预留了2个字符宽度的边距（由`LIVE_PREFIX_COLS`常量定义），用于对齐和视觉分隔。输入框支持多种交互模式，包括普通文本输入、命令输入和文件搜索。当用户输入以斜杠（/）开头的文本时，系统会激活命令提示符，显示可用的内置命令和自定义提示。

命令提示符是一个动态弹出的菜单，会根据用户输入的内容实时过滤和显示匹配的选项。用户可以使用上下箭头键或Ctrl+N/Ctrl+P快捷键在选项间导航，按Tab键进行补全，或按Enter键直接提交选中的命令。除了命令提示符，输入框还支持文件搜索功能，当用户输入文件路径或使用特定语法时，系统会自动搜索匹配的文件并提供选择。

功能按钮集成在底部面板的辅助区域，包括提交按钮、清除按钮和设置按钮等。这些按钮提供了快速访问常用功能的途径，增强了用户的操作效率。此外，底部面板还会根据当前状态显示相应的提示信息，如任务运行时的“工作”状态指示器，或需要用户确认时的审批请求。

**Section sources**
- [bottom_pane/chat_composer.rs](file://codex-rs/tui/src/bottom_pane/chat_composer.rs#L95-L123)
- [bottom_pane/mod.rs](file://codex-rs/tui/src/bottom_pane/mod.rs#L64-L90)
- [ui_consts.rs](file://codex-rs/tui/src/ui_consts.rs#L1-L11)

## 组件相对位置示意图

以下是Codex TUI界面各组件的相对位置和视觉层次的文字描述：

```
+-----------------------------------------------------------+
| 账户信息 | 信用额度 | 速率限制状态 | 上下文窗口使用情况       |
+-----------------------------------------------------------+
|                                                           |
|                   聊天历史显示区                          |
|                                                           |
|  用户: 你好，请帮我写一个Python函数                        |
|                                                           |
|  AI: 当然可以！以下是一个示例函数：                       |
|      def hello_world():                                   |
|          print("Hello, World!")                           |
|                                                           |
+-----------------------------------------------------------+
|                                                           |
|                   实时响应流式渲染区                      |
|                                                           |
|  AI: 正在生成响应...                                     |
|                                                           |
+-----------------------------------------------------------+
|                                                           |
|  [▌ ] 聊天输入框                                          |
|                                                           |
|  命令提示符: /help /skills /status                        |
|                                                           |
|  功能按钮: [提交] [清除] [设置]                           |
|                                                           |
+-----------------------------------------------------------+
```

该示意图展示了界面的垂直分层结构。顶部状态栏横向排列，显示关键的账户和配额信息。中部是主要的聊天历史显示区和实时响应流式渲染区，占据了界面的大部分空间。底部是输入与状态控制区，包含聊天输入框、命令提示符和功能按钮。各区域之间通过清晰的边界分隔，形成了良好的视觉层次和操作流。

**Section sources**
- [app.rs](file://codex-rs/tui/src/app.rs#L623-L648)
- [chatwidget.rs](file://codex-rs/tui/src/chatwidget.rs#L313-L372)
- [bottom_pane/mod.rs](file://codex-rs/tui/src/bottom_pane/mod.rs#L64-L90)