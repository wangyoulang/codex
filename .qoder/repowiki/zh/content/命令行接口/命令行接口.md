# 命令行接口

<cite>
**本文档中引用的文件**   
- [main.rs](file://codex-rs/cli/src/main.rs)
- [mcp_cmd.rs](file://codex-rs/cli/src/mcp_cmd.rs)
- [debug_sandbox.rs](file://codex-rs/cli/src/debug_sandbox.rs)
- [exec/main.rs](file://codex-rs/exec/src/main.rs)
- [mcp-server/main.rs](file://codex-rs/mcp-server/src/main.rs)
- [config_override.rs](file://codex-rs/common/src/config_override.rs)
</cite>

## 目录
1. [简介](#简介)
2. [主命令与全局选项](#主命令与全局选项)
3. [exec 模式](#exec-模式)
4. [mcp-server 模式](#mcp-server-模式)
5. [sandbox 测试命令](#sandbox-测试命令)
6. [配置覆盖机制](#配置覆盖机制)

## 简介
Codex 命令行接口（CLI）提供了一个多功能工具，用于与 Codex AI 代理进行交互。该接口支持多种操作模式，包括交互式会话、非交互式执行、MCP 服务器管理和沙箱测试。本文档详细介绍了 `codex` 命令的所有子命令、全局选项以及它们的使用方法。

**Section sources**
- [main.rs](file://codex-rs/cli/src/main.rs#L49-L63)

## 主命令与全局选项
`codex` 命令是所有操作的入口点。当不指定子命令时，将启动交互式 CLI。全局选项可以与任何子命令一起使用，以覆盖默认配置。

### 语法
```bash
codex [OPTIONS] [PROMPT]
codex [OPTIONS] <COMMAND> [ARGS]
```

### 全局选项
- `-c, --config key=value`: 覆盖配置值。使用点路径（如 `foo.bar.baz`）来覆盖嵌套值。
- `--enable FEATURE`: 启用功能标志。
- `--disable FEATURE`: 禁用功能标志。

**Section sources**
- [main.rs](file://codex-rs/cli/src/main.rs#L64-L76)

## exec 模式
`exec` 模式允许以非交互方式运行 Codex，适用于脚本化和自动化工作流。

### 语法
```bash
codex exec [OPTIONS] [PROMPT]
```

### 参数
- `[PROMPT]`: 要执行的提示。

### 输出模式
- `--jsonl`: 以 JSONL 格式输出，便于机器解析。
- `--human`: 以人类可读格式输出。

### 使用示例
```bash
# 非交互式执行提示
codex exec "列出当前目录下的文件"

# 以 JSONL 格式输出
codex exec --jsonl "获取系统信息"
```

**Section sources**
- [main.rs](file://codex-rs/cli/src/main.rs#L80-L82)
- [exec/main.rs](file://codex-rs/exec/src/main.rs#L18-L25)

## mcp-server 模式
`mcp-server` 模式用于启动一个 MCP 服务器，供其他 AI 代理连接和使用。

### 语法
```bash
codex mcp-server
```

### 功能
- 启动 MCP 服务器，通过标准输入/输出与客户端通信。
- 支持通过配置文件和环境变量进行配置。

### 使用示例
```bash
# 启动 MCP 服务器
codex mcp-server
```

**Section sources**
- [main.rs](file://codex-rs/cli/src/main.rs#L96-L97)
- [mcp-server/main.rs](file://codex-rs/mcp-server/src/main.rs#L5-L10)

## sandbox 测试命令
`sandbox` 命令用于在 Codex 提供的沙箱环境中运行命令，以测试沙箱配置。

### 语法
```bash
codex sandbox [SUBCOMMAND] [ARGS]
```

### 子命令
- `macos`: 在 macOS 上使用 Seatbelt 运行命令。
- `linux`: 在 Linux 上使用 Landlock 运行命令。
- `windows`: 在 Windows 上使用受限令牌运行命令。

### 使用示例
```bash
# 在 Linux 沙箱中运行命令
codex sandbox linux --full-auto ls -la
```

**Section sources**
- [main.rs](file://codex-rs/cli/src/main.rs#L105-L108)
- [debug_sandbox.rs](file://codex-rs/cli/src/debug_sandbox.rs#L26-L94)

## 配置覆盖机制
Codex 支持通过命令行参数、配置文件和环境变量来覆盖配置。命令行参数具有最高优先级。

### 覆盖优先级
1. 命令行参数 (`-c key=value`)
2. 环境变量
3. 配置文件

### 使用示例
```bash
# 覆盖模型配置
codex -c model="o3" exec "生成代码"
```

**Section sources**
- [config_override.rs](file://codex-rs/common/src/config_override.rs#L15-L36)
- [main.rs](file://codex-rs/cli/src/main.rs#L444-L446)